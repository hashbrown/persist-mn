---
import { getCollection } from 'astro:content';
import Layout from '../layouts/Layout.astro';
import Header from '../components/Header.astro';
import SearchBox from '../components/SearchBox.astro';
import CategoryFilter from '../components/CategoryFilter.astro';
import BusinessCard from '../components/BusinessCard.astro';
import Pagination from '../components/Pagination.astro';
import { ITEMS_PER_PAGE } from '../utils/pagination';
import { CONTENT } from '../utils/content';

// Get all businesses
const allBusinesses = await getCollection('businesses');

// Sort by display name
const businesses = allBusinesses.sort((a, b) =>
  a.data.displayName.localeCompare(b.data.displayName)
);

// Paginate
const totalPages = Math.ceil(businesses.length / ITEMS_PER_PAGE);
const currentPage = 1;
const startIndex = 0;
const endIndex = ITEMS_PER_PAGE;
const paginatedBusinesses = businesses.slice(startIndex, endIndex);
---

<Layout title={CONTENT.pages.home.title}>
  <Header />

  <div class="block md:hidden max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 mt-4">
    <SearchBox id="mobile-search" />
  </div>

  <CategoryFilter />

  <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <div class="mb-6">
      <h2 class="text-2xl font-bold text-gray-900">
        {CONTENT.pages.home.heading}
      </h2>
      <p class="text-gray-600 mt-1">
        {CONTENT.pages.home.descriptionTemplate(businesses.length)}
      </p>
    </div>

    <div class="space-y-6">
      {paginatedBusinesses.map((business) => (
        <BusinessCard business={business} />
      ))}
    </div>

    <Pagination
      currentPage={currentPage}
      totalPages={totalPages}
      baseUrl=""
    />
  </main>
</Layout>
